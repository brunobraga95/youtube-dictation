let words = [
  {
    word: "it's",
    currentTime: 139.860033,
    intensity: 0.09764673215941526,
    averageIntensity: 0.030799346659325308,
    percentIntensity: 3.170415698732043,
  },
  {
    word: 'impossible.',
    currentTime: 140.178451,
    intensity: 0.08989655739227238,
    averageIntensity: 0.030978721917242925,
    percentIntensity: 2.901880769401125,
  },
  {
    word: 'But',
    currentTime: 141.379123,
    intensity: 0.04026172043073856,
    averageIntensity: 0.03156699466403143,
    percentIntensity: 1.2754372362413775,
  },
  {
    word: 'the',
    currentTime: 141.694699,
    intensity: 0.017696825999046685,
    averageIntensity: 0.024114476114957577,
    percentIntensity: 0.733867321632163,
  },
  {
    word: 'as',
    currentTime: 142.332032,
    intensity: 0.049100609824700235,
    averageIntensity: 0.024144472840991072,
    percentIntensity: 2.03361697511739,
  },
  {
    word: 'I',
    currentTime: 142.566699,
    intensity: 0.036998167306330314,
    averageIntensity: 0.02424580622855884,
    percentIntensity: 1.5259615191822584,
  },
  {
    word: 'said',
    currentTime: 142.816857,
    intensity: 0.0997948374186345,
    averageIntensity: 0.02444099328255438,
    percentIntensity: 4.083092543127802,
  },
  {
    word: 'the',
    currentTime: 143.052032,
    intensity: 0.14645274885579185,
    averageIntensity: 0.024658272221656338,
    percentIntensity: 5.939294835392744,
  },
  {
    word: 'core',
    currentTime: 143.284798,
    intensity: 0.12916160747053465,
    averageIntensity: 0.02477836949069072,
    percentIntensity: 5.212675818683748,
  },
  {
    word: 'of',
    currentTime: 143.451711,
    intensity: 0.10210768969603971,
    averageIntensity: 0.024889428992563564,
    percentIntensity: 4.10245207821149,
  },
  {
    word: 'the',
    currentTime: 143.617366,
    intensity: 0.10770918731487804,
    averageIntensity: 0.024983109165229812,
    percentIntensity: 4.311280337548301,
  },
  {
    word: 'issue',
    currentTime: 143.766699,
    intensity: 0.03732375345430981,
    averageIntensity: 0.025507010452688564,
    percentIntensity: 1.4632743230940146,
  },
  {
    word: 'is',
    currentTime: 145.103754,
    intensity: 0.02443312383753228,
    averageIntensity: 0.02550792144989193,
    percentIntensity: 0.957864163316051,
  },
  {
    word: 'well',
    currentTime: 146.097366,
    intensity: 0.02443312383753228,
    averageIntensity: 0.025508229615330308,
    percentIntensity: 0.9578525913397026,
  },
  {
    word: 'if',
    currentTime: 146.33508,
    intensity: 0.026430552157779494,
    averageIntensity: 0.025634897317955773,
    percentIntensity: 1.0310379569676065,
  },
  {
    word: 'good',
    currentTime: 146.566699,
    intensity: 0.1127059670365689,
    averageIntensity: 0.025794137114826546,
    percentIntensity: 4.369441262362879,
  },
  {
    word: 'men',
    currentTime: 147.167509,
    intensity: 0.12504679274715763,
    averageIntensity: 0.02620539011630235,
    percentIntensity: 4.771796649169749,
  },
  {
    word: "don't",
    currentTime: 148.166699,
    intensity: 0.02574299074370716,
    averageIntensity: 0.026354300312012798,
    percentIntensity: 0.9768041814402869,
  },
  {
    word: 'hoist',
    currentTime: 148.481366,
    intensity: 0.09961181448595337,
    averageIntensity: 0.02651736266191762,
    percentIntensity: 3.7564751727368755,
  },
  {
    word: 'their',
    currentTime: 149.217283,
    intensity: 0.11214761909757795,
    averageIntensity: 0.026946793036308304,
    percentIntensity: 4.161816916264189,
  },
  {
    word: 'political',
    currentTime: 149.535073,
    intensity: 0.061267451710148246,
    averageIntensity: 0.027092285310803276,
    percentIntensity: 2.261435349852799,
  },
  {
    word: 'load',
    currentTime: 149.932032,
    intensity: 0.04886496874331189,
    averageIntensity: 0.027723315092298938,
    percentIntensity: 1.7625947178620693,
  },
  {
    word: 'then',
    currentTime: 151.568133,
    intensity: 0.02351317071004281,
    averageIntensity: 0.027704010552123327,
    percentIntensity: 0.8487280448368397,
  },
  {
    word: 'the',
    currentTime: 152.566699,
    intensity: 0.02478665942703305,
    averageIntensity: 0.027717801220547452,
    percentIntensity: 0.8942505659019764,
  },
  {
    word: 'pathological',
    currentTime: 154.054699,
    intensity: 0.05346215266912223,
    averageIntensity: 0.028408296696797893,
    percentIntensity: 1.8819203854326239,
  },
  {
    word: 'will',
    currentTime: 155.051299,
    intensity: 0.0213955382660317,
    averageIntensity: 0.028384915627747795,
    percentIntensity: 0.7537643777639557,
  },
  {
    word: 'take',
    currentTime: 155.451408,
    intensity: 0.07013222551079223,
    averageIntensity: 0.028508014392792273,
    percentIntensity: 2.460088049082923,
  },
  {
    word: 'their',
    currentTime: 155.617366,
    intensity: 0.07760875217331337,
    averageIntensity: 0.028573737612403647,
    percentIntensity: 2.716086821614264,
  },
  {
    word: 'place',
    currentTime: 155.852032,
    intensity: 0.08584676484270949,
    averageIntensity: 0.02867588436652774,
    percentIntensity: 2.993691972859087,
  },
  {
    word: 'and',
    currentTime: 156.735826,
    intensity: 0.03694420434270218,
    averageIntensity: 0.02885852881039035,
    percentIntensity: 1.2801832201993828,
  },
];
function extractLastSentenceFromWordArrayBasedOnTime(wordsArray, pauseThreshold, updateArray) {
  function getWordsBetween(wordsArray, startIndex, endIndex) {
    const slice = wordsArray.slice(startIndex, endIndex + 1); // inclusive
    const sentence = slice.map((obj) => obj.word).join(' ');
    return sentence;
  }
  function getWordsAndUpdateState(wordsArray, startIndex, endIndex) {
    const res = getWordsBetween(wordsArray, startIndex, endIndex);
    updateArray(wordsArray.slice(endIndex + 1));
    return res;
  }
  const MIN_WORDS = 8;
  const MAX_WORDS = 18;
  if (!wordsArray || wordsArray.length < 19) {
    return '';
  }
  let lowIntensities = [];
  // Find all the pause points (indices where the next word is delayed)
  for (let i = 0; i < wordsArray.length - 1; i++) {
    const currentWord = wordsArray[i];
    const nextWordIntensity = wordsArray[i + 1].intensity;
    //const pause = currentWord.currentTime - previous.currentTime;
    const intensityChange = nextWordIntensity / currentWord.intensity;
    if (intensityChange < 0.4) {
      console.log(
        'low intensity word: ',
        i,
        ' -- ',
        currentWord.word,
        ' -- ',
        nextWordIntensity,
        ' -- ',
        currentWord.intensity,
        ' -- ',
        intensityChange
      );
      lowIntensities.push(i);
    }
  }
  console.log('lowIntensities: ', lowIntensities);
  if (
    lowIntensities.length < 2 ||
    lowIntensities[lowIntensities.length - 1] - lowIntensities[0] < MIN_WORDS
  ) {
    return getWordsAndUpdateState(wordsArray, wordsArray.length - MAX_WORDS, wordsArray.length - 1);
  }
  if (lowIntensities[lowIntensities.length - 1] - lowIntensities[0] <= MAX_WORDS) {
    return getWordsAndUpdateState(
      wordsArray,
      lowIntensities[0],
      lowIntensities[lowIntensities.length - 1]
    );
  }
  let start = lowIntensities[0];
  let end = lowIntensities[lowIntensities.length - 1];
  while (start - end > MAX_WORDS && start >= MIN_WORDS) {
    start--;
  }
  if (start < MIN_WORDS) {
    return getWordsAndUpdateState(wordsArray, wordsArray.length - MAX_WORDS, wordsArray.length - 1);
  }
  return getWordsAndUpdateState(wordsArray, start - 1, end + 1);
}

const setStateCheck = (state) => console.log(state);

console.log(extractLastSentenceFromWordArrayBasedOnTime(words, 0.1, setStateCheck));
